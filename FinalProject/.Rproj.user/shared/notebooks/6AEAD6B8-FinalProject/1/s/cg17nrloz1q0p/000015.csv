"0","# Load necessary libraries"
"0","library(ggplot2)"
"0","library(dplyr)"
"0","library(tidyr)"
"0",""
"0","# Load the data"
"0","laliga_xg <- read.csv(""archive/Laliga_table_xg_2023_24.csv"")"
"0","laliga_table <- read.csv(""archive/Laliga_table_2023_24.csv"")"
"0",""
"0","# Prepare the data"
"0","laliga_table <- laliga_table %>%"
"0","  separate(scoresStr, into = c(""goalsScored"", ""goalsConceded""), sep = ""-"", convert = TRUE) # Extract actual goals conceded"
"0",""
"0","merged_data <- laliga_xg %>%"
"0","  inner_join(laliga_table, by = c(""name"", ""played"")) %>%"
"0","  filter(idx.x <= 6) %>% # Filter top 6 teams (if needed)"
"0","  mutate(conceded_diff = xgConceded - as.numeric(goalsConceded)) # Calculate the difference"
"0",""
"0","# Divergence plot for xGConceded vs. Goals Conceded"
"0","divergence_plot <- ggplot(merged_data, aes(x = reorder(name, conceded_diff), y = conceded_diff, fill = conceded_diff > 0)) +"
"0","  geom_bar(stat = ""identity"", width = 0.6) +"
"0","  geom_text(aes(label = round(conceded_diff, 2)), vjust = ifelse(merged_data$conceded_diff > 0, -0.5, 1.5), size = 3) +"
"0","  scale_fill_manual("
"0","    values = c(`TRUE` = ""blue"", `FALSE` = ""red""),  # Correctly formatted logical values"
"0","    labels = c(""Underperformance"", ""Overperformance"")"
"0","  ) +"
"0","  labs("
"0","    title = ""Divergence Plot: xGConceded vs. Actual Goals Conceded"","
"0","    subtitle = ""Difference between Expected Goals Conceded (xGConceded) and Actual Goals Conceded"","
"0","    x = ""Team"","
"0","    y = ""Difference (xGConceded - Goals Conceded)"","
"0","    fill = ""Performance"""
"0","  ) +"
"0","  theme_minimal() +"
"0","  theme(axis.text.x = element_text(angle = 45, hjust = 1))"
"0",""
"0","# Display the divergence plot"
"0","print(divergence_plot)"
